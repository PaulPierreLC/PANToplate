<!DOCTYPE html>
<html lang="fr">
  <head>
    <meta charset="UTF-8">
    <title>Accueil</title>
    <link rel="icon" type="image/x-icon" href="/assets/images/favicon.png">
    <link rel="stylesheet" href="/assets/styles/custom.css">
    <link rel="stylesheet" href="/assets/styles/style.css">
    <link rel="stylesheet" href="/node_modules/bootstrap-icons/font/bootstrap-icons.css">

</head>
<body>
  <header class="py-1 text-white">
    <img src="/assets/images/Header et Footer/Logo II.png">
<div class="titre">
  <a href="/src/index.html">
  <h1 class="title mb-0 me-auto text-white">
    <span class="praise">Pan</span> <span class="poppins">to plate</span>
  </h1>
</a>
</div>
<div class="search-bar">
  <button>X</button>
  <input type="text" placeholder="Recherchez une ville...">
</div>
<div class="nav-item">
  <a href="#">
  <i class="cart bi bi-cart3 h2 text-white"></i>
  </a>
  </div>
  <div class="connexion">
    <a href="#">
    <button class="btn-connexion">Connexion
      <i class="bi bi-box-arrow-in-right"></i>
      </button>
    </a>    
  </div>
</div>
<div class="profil">
  <a href="#">
    <i class="bi bi-person text-white h1"></i>
  </a>
</div>
</header>
    
<main>
    <div style="background-image: url('/assets/images/connexion/top-view-pasta-seafood-wooden-table.jpg'); background-size: 300vh; background-position: center; height: 100vh; width: 100vw; overflow: hidden;">
        <div class="col">
            <div class="row">
                <div class="col"></div>
                <div class="col">
                    <div class="bg-light p-2 rounded-4" style="margin-top: 25vh; margin-right: 5vw;">
                        <form id="registrationForm">
                            <div class="col">
                                <div class="row">
                                    <div class="col">
                                        <div class="form-group py-1">
                                            <input type="email" class="form-control" id="mail" name="mail" placeholder="Adresse-e-mail" required>
                                        </div>
                                    </div>
                                    <div class="col">
                                        <div class="form-group py-1">
                                            <input type="text" class="form-control" id="phonenumber" name="phonenumber" placeholder="Téléphone" required>
                                        </div>
                                    </div>
                                </div>
                                <div class="row">
                                    <div class="col">
                                        <div class="form-group py-1">
                                            <input type="text" class="form-control" id="nom" name="nom" placeholder="Nom" required>
                                        </div>
                                    </div>
                                    <div class="col">
                                        <div class="form-group py-1">
                                            <input type="text" class="form-control" id="prenom" name="prenom" placeholder="Prénom" required>
                                        </div>
                                    </div>
                                </div>
                                <div class="form-group py-1">
                                    <input type="date" class="form-control" id="naissance" name="naissance" placeholder="Date de naissance" required>
                                </div>
                                <div class="dropdown py-1">
                                    <button class="btn border dropdown-toggle bg-light w-100" type="button" id="genre" data-bs-toggle="dropdown" aria-expanded="false">
                                        Sélectionnez votre genre
                                    </button>
                                    <ul class="dropdown-menu w-100" aria-labelledby="dropdownMenuButton" id="genreOptions">
                                        <li><a class="dropdown-item" href="#" data-value="Homme">Homme</a></li>
                                        <li><a class="dropdown-item" href="#" data-value="Femme">Femme</a></li>
                                        <li><a class="dropdown-item" href="#" data-value="Autre">Autre</a></li>
                                    </ul>
                                    <input type="hidden" id="selectedGenre" name="genre" required>
                                </div>
                                <div class="form-group py-1">
                                    <input type="password" class="form-control" id="password" name="password" placeholder="Mot de passe" required>
                                </div>
                                <div class="form-group py-1">
                                    <input type="password" class="form-control" id="passwordConfirmation" name="passwordConfirmation" placeholder="Confirmez votre mot de passe" required>
                                </div>
                                <div id="passwordError" style="color: red; display: none;">Les mots de passe ne correspondent pas.</div>
                                <button type="submit" class="btn btn-primary w-100">S'inscrire</button>
                            </div>
                        </form>
                    </div>
                </div>
                <div class="col"></div>
            </div>
        </div>
    </div>
</main>

  <footer class="py-2 fixed-bottom">
    <div class="footer-content">
        <ul class="footer-social-links list-inline">
            <li class="list-inline-item bi-instagram h2"><a href="#">  </a></li>
            <li class="list-inline-item bi bi-facebook h2"><a href="#"> </a></li>
            <li class="list-inline-item bi bi-twitter h2"><a href="#"></a></li>   
        </ul>
        <ul class="footer-mention">
            <li><a href="/src/mentions légales/mentions_legales.html">Mentions légales</a></li>
            <li><a href="#">Cookies</a></li>
            <li><a href="/src/politique de confidentialité/confidentialité.html">Politique de confidentialité</a></li>
            <li><a href="#">© Pan to Plate FRANCE 2024 Created by NAPT</a></li>
        </ul>
    </div>
  </footer>
<script src="/node_modules/bootstrap/dist/js/bootstrap.bundle.min.js"></script> 
<script src="/assets/scripts/js-accueil/script.js"></script>
<script>
    document.getElementById("genreOptions").addEventListener("click", function(event) {
        if (event.target.tagName === "A") {
            event.preventDefault();
            const selectedGenre = event.target.getAttribute("data-value");
            document.getElementById("selectedGenre").value = selectedGenre;
            document.getElementById("genre").textContent = selectedGenre;
        }
    });

    document.getElementById("registrationForm").addEventListener("submit", async function(event) {
        event.preventDefault();

        const mail = document.getElementById("mail").value;
        const phonenumber = document.getElementById("phonenumber").value;
        const nom = document.getElementById("nom").value;
        const prenom = document.getElementById("prenom").value;
        const password = document.getElementById("password").value;
        const passwordConfirmation = document.getElementById("passwordConfirmation").value;
        const genre = document.getElementById("selectedGenre").value;

        if (password !== passwordConfirmation) {
            document.getElementById("passwordError").style.display = "block";
            return;
        } else {
            document.getElementById("passwordError").style.display = "none";
        }

        const userData = {
            "prenom": prenom,
            "nom": nom,
            "telMobile": phonenumber,
            "telFix": null,
            "mail": mail,
            "parametre": "{}",
            "pointsFidelite": 0,
            "idRole": { "id": 2 },
            "idVehicule": null,
            "dateCreer": new Date().toISOString(), 
        };

        try {
            const userResponse = await fetch("http://localhost:8080/api/utilisateurs", {
                method: "POST",
                headers: {
                    "Content-Type": "application/json"
                },
                body: JSON.stringify(userData)
            });

            if (!userResponse.ok) {
                const userError = await userResponse.json();
                throw new Error("Erreur lors de la création de l'utilisateur : " + userError.message);
            }

            const userResult = await userResponse.json();
            const utilisateurId = userResult.id;
            console.log("Utilisateur créé avec succès :", userResult);

            const loginData = {
                "utilisateur": { "id": utilisateurId },
                "login": mail,
                "motDePasse": password
            };

            const loginResponse = await fetch("http://localhost:8080/api/logins", {
                method: "POST",
                headers: {
                    "Content-Type": "application/json"
                },
                body: JSON.stringify(loginData)
            });

            if (!loginResponse.ok) {
                const loginError = await loginResponse.json();
                throw new Error("Erreur lors de la création du login : " + loginError.message);
            }

            const loginResult = await loginResponse.json();
            console.log("Login créé avec succès :", loginResult);

            alert("Inscription réussie !");
            window.location.href = "/src/connexion/connexion.html";
        } catch (error) {
            console.error("Erreur :", error.message);
            alert(error.message);
        }
    });
</script>
</body>
</html>